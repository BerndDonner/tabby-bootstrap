#!/usr/bin/env bash
# ===============================================================
# ðŸ’‰ pre-commit: ensure all stripsecrets-filtered files are clean
# ===============================================================
set -euo pipefail

# Find staged files using the 'stripsecrets' filter
FILES=$(git diff --cached --name-only \
  | xargs -r git check-attr filter \
  | awk -F: '/stripsecrets/ {print $1}' \
  | sort -u)

[[ -z "$FILES" ]] && exit 0  # nothing to do

echo "==> Reapplying strip-secrets filter to:"
for f in $FILES; do
  if [[ -f "$f" ]]; then
    echo "   â€¢ $f"
    git add --renormalize "$f"
  fi
done
