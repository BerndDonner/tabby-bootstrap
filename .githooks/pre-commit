#!/usr/bin/env bash
# ===============================================================
# ðŸ’‰ pre-commit: ensure secrets/seed.sh is filtered before commit
# ===============================================================
set -euo pipefail
set -x

TARGET="secrets/seed.sh"
REPO_ROOT="$(git rev-parse --show-toplevel)"

echo "Running hook from: $(pwd)"
echo "Repo root: $REPO_ROOT"

if [[ -f "$REPO_ROOT/$TARGET" ]]; then
  if git -C "$REPO_ROOT" check-attr filter "$TARGET" | grep -q stripsecrets; then
    echo "==> Reapplying strip-secrets filter to $TARGET"
    git -C "$REPO_ROOT" add --force "$TARGET"
  fi
fi
